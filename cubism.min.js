(function(a){function c(a){var b={};return b.metric=function(b,c){function l(){var k=b.stop();e||(e=g),f=Math.round((b.start()-g)/h),a(c,e,k,h,function(a,b){if(a)return console.warn(a);b.forEach(function(a){j[Math.round((a[0]-g)/h)%i]=a[1]}),e=new Date(k-d*h)})}var e,f,g=b.start(),h=b.step(),i=b.size(),j=new Array(i),k;setTimeout(l,10);var m=b.delay()-b.step()/2;return m>1e3&&(k=setTimeout(l,m)),b.on("change",function(){k&&clearTimeout(k),k=setTimeout(l,b.step()/2)}),b.on("cancel",function(){k=clearTimeout(k)}),j.valueAt=function(a){return j[(a+f)%i]},j.toString=function(){return c},j},b}function e(a){return Math.floor(a/1e3)}function f(a){var b=a.indexOf("|"),c=a.substring(0,b),d=c.lastIndexOf(","),e=c.lastIndexOf(",",d-1),f=c.lastIndexOf(",",e-1),g=c.substring(f+1,e)*1e3,h=c.substring(d+1)*1e3;return a.substring(b+1).split(",").map(function(a,b){return[new Date(g+b*h),+a]}).slice(1)}function g(){}var b=a.cubism={version:"0.0.1"},d=6;b.cube=function(a){arguments.length||(a="");var b=d3.time.format.iso,d=c(function(c,d,e,f,g){d3.json(a+"/1.0/metric"+"?expression="+encodeURIComponent(c)+"&start="+b(d)+"&stop="+b(e)+"&step="+f,function(a){if(!a)return g(new Error("unable to load data"));g(null,a.map(function(a){return[b.parse(a.time),a.value]}))})});return d.toString=function(){return a},d},b.graphite=function(a){arguments.length||(a="");var b=c(function(b,c,d,g,h){d3.text(a+"/render?format=raw"+"&target="+encodeURIComponent("alias("+b+",'')")+"&from="+e(c-2*g)+"&until="+e(d-1e3),function(a){if(!a)return h(new Error("unable to load data"));h(null,f(a))})});return b.toString=function(){return a},b},b.context=function(){function i(){k(),f.change.call(a),j()}function j(){h=setTimeout(i,a.delay())}function k(){var f=Date.now();return c=new Date(Math.floor(f/d)*d),b=new Date(c-e*d),a}var a=new g,b=new Date(NaN),c=new Date(NaN),d,e,f=d3.dispatch("change","cancel"),h;return setTimeout(j,10),a.start=function(){return b},a.stop=function(){return c},a.delay=function(){return+c+d-Date.now()},a.step=function(a){if(!arguments.length)return d;if(h)throw new Error("step cannot be changed mid-flight");return d=+a,k()},a.size=function(a){if(!arguments.length)return e;if(h)throw new Error("size cannot be changed mid-flight");return e=+a,k()},a.shift=function(h){var i=new g;return i.start=function(){return new Date(+b+h)},i.stop=function(){return new Date(+c+h)},i.delay=a.delay,i.step=function(){return d},i.size=function(){return e},i.timeAt=function(a){return new Date(+b+a*d+h)},d3.rebind(i,f,"on")},a.cancel=function(){return h&&(h=clearTimeout(h),f.cancel.call(a)),a},a.timeAt=function(a){return new Date(+b+a*d)},d3.rebind(a,f,"on"),a.step(1e4).size(1440)}})(this);