(function(a){function c(a,b){var c={},d=d3.time.format.iso;return c.host=function(){return b},c.metric=function(c){function j(){var b=a.start(),j=a.stop(),k=a.step(),l=a.size();h?b=new Date(j-i*k):h=b,f.send(JSON.stringify({expression:c,start:d(b),stop:d(j),step:k})),f.onmessage=function(a){var b=JSON.parse(a.data);b=[d.parse(b.time),b.value],e[Math.round((b[0]-h)/k)%l]=b,g.change.call(e,[b])}}var e=[],f=new WebSocket(b+"/1.0/metric/get"),g=d3.dispatch("change"),h,i=6;return f.onopen=j,e.expression=function(){return c},a.on("change",j).on("cancel",function(){f.close()}),d3.rebind(e,g,"on"),e},c}function d(a,b){var c={};return c.host=function(){return b},c.metric=function(c){function l(){var k=a.start(),l=a.stop(),m=a.step(),n=a.size();h||(h=i=k),d3.text(b+"/render?format=raw"+"&target="+encodeURIComponent("alias("+c+",'')")+"&from="+e(h-2*m)+"&until="+e(l-1e3),function(a){if(a){var b=f(a);b.forEach(function(a){d[Math.round((a[0]-i)/m)%n]=a}),h=new Date(l-j*m),g.change.call(d,b)}})}var d=[],g=d3.dispatch("change"),h,i,j=6,k;return setTimeout(l,10),a.on("change",function(){k&&clearTimeout(k),k=setTimeout(l,a.step()/2)}),d.expression=function(){return c},d3.rebind(d,g,"on"),d},c}function e(a){return Math.floor(a/1e3)}function f(a){var b=a.indexOf("|"),c=a.substring(0,b),d=c.lastIndexOf(","),e=c.lastIndexOf(",",d-1),f=c.lastIndexOf(",",e-1),g=c.substring(f+1,e)*1e3,h=c.substring(d+1)*1e3;return a.substring(b+1).split(",").map(function(a,b){return[new Date(g+b*h),+a]}).slice(1)}function g(){}var b=a.cubism={version:"0.0.1"};g.prototype.cube=function(a){return new c(this,arguments.length?a:"")},g.prototype.graphite=function(a){return new d(this,arguments.length?a:"")},b.context=function(){function i(){k(),f.change.call(a),j()}function j(){var a=+c+d-Date.now();a<d/2&&(a+=d),h=setTimeout(i,a)}function k(){var f=Date.now();return c=new Date(Math.floor(f/d)*d),b=new Date(c-e*d),a}var a=new g,b=new Date(NaN),c=new Date(NaN),d,e,f=d3.dispatch("change","cancel"),h;return setTimeout(j,10),a.start=function(){return b},a.stop=function(){return c},a.step=function(a){if(!arguments.length)return d;if(h)throw new Error("step cannot be changed mid-flight");return d=+a,k()},a.size=function(a){if(!arguments.length)return e;if(h)throw new Error("size cannot be changed mid-flight");return e=+a,k()},a.cancel=function(){return h=clearTimeout(h),f.cancel.call(a),a},d3.rebind(a,f,"on"),a.step(1e4).size(1440)}})(this);