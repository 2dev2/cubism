(function(a){function c(a){var b={};return b.metric=function(b,c){function n(){var e=b.stop();g||(g=i),h=Math.round((b.start()-i)/j),a(c,g,e,j,function(a,b){if(a)return console.warn(a);b.forEach(function(a){l[Math.round((a[0]-i)/j)%k]=a[1]}),g=new Date(e-d*j)})}var f=new e,g,h,i=b.start(),j=b.step(),k=b.size(),l=new Array(k),m;setTimeout(n,10);var o=b.delay()-b.step()/2;return o>1e3&&(m=setTimeout(n,o)),b.on("change",function(){m&&clearTimeout(m),m=setTimeout(n,b.step()/2)}),b.on("cancel",function(){m=clearTimeout(m)}),f.size=function(){return k},f.extent=function(){return d3.extent(l)},f.valueAt=function(a){return l[(a+h)%k]},f.toString=function(){return c},f},b}function e(){}function f(a){return Math.floor(a/1e3)}function g(a){var b=a.indexOf("|"),c=a.substring(0,b),d=c.lastIndexOf(","),e=c.lastIndexOf(",",d-1),f=c.lastIndexOf(",",e-1),g=c.substring(f+1,e)*1e3,h=c.substring(d+1)*1e3;return a.substring(b+1).split(",").map(function(a,b){return[new Date(g+b*h),+a]}).slice(1)}function h(){}function i(a,b){if(a.size()!==b.size())throw new Error("different size!");var c=new e;return c.extent=function(){return d3.extent(d3.range(a.size()),c.valueAt)},c.valueAt=function(c){return a.valueAt(c)+b.valueAt(c)},c.toString=function(){return a+" + "+b},c.size=a.size,c}function j(a,b){if(a.size()!==b.size())throw new Error("different size!");var c=new e;return c.extent=function(){return d3.extent(d3.range(a.size()),c.valueAt)},c.valueAt=function(c){return a.valueAt(c)-b.valueAt(c)},c.toString=function(){return a+" - "+b},c.size=a.size,c}function k(a,b){if(a.size()!==b.size())throw new Error("different size!");var c=new e;return c.extent=function(){return d3.extent(d3.range(a.size()),c.valueAt)},c.valueAt=function(c){return a.valueAt(c)*b.valueAt(c)},c.toString=function(){return a+" * "+b},c.size=a.size,c}function l(a,b){if(a.size()!==b.size())throw new Error("different size!");var c=new e;return c.extent=function(){return d3.extent(d3.range(a.size()),c.valueAt)},c.valueAt=function(c){return a.valueAt(c)/b.valueAt(c)},c.toString=function(){return a+" / "+b},c.size=a.size,c}function m(a,b){b=+b,a=+a;var c=new e;return c.extent=function(){return[b,b]},c.valueAt=function(){return b},c.toString=function(){return b+""},c.size=function(){return a},c}var b=a.cubism={version:"0.0.1"},d=6;b.cube=function(a){arguments.length||(a="");var b=d3.time.format.iso,d=c(function(c,d,e,f,g){d3.json(a+"/1.0/metric"+"?expression="+encodeURIComponent(c)+"&start="+b(d)+"&stop="+b(e)+"&step="+f,function(a){if(!a)return g(new Error("unable to load data"));g(null,a.map(function(a){return[b.parse(a.time),a.value]}))})});return d.toString=function(){return a},d},b.graphite=function(a){arguments.length||(a="");var b=c(function(b,c,d,e,h){d3.text(a+"/render?format=raw"+"&target="+encodeURIComponent("alias("+b+",'')")+"&from="+f(c-2*e)+"&until="+f(d-1e3),function(a){if(!a)return h(new Error("unable to load data"));h(null,g(a))})});return b.toString=function(){return a},b},b.context=function(){function i(){k(),f.change.call(a),j()}function j(){g=setTimeout(i,a.delay())}function k(){var f=Date.now();return c=new Date(Math.floor(f/d)*d),b=new Date(c-e*d),a}var a=new h,b=new Date(NaN),c=new Date(NaN),d,e,f=d3.dispatch("change","cancel"),g;return setTimeout(j,10),a.start=function(){return b},a.stop=function(){return c},a.delay=function(){return+c+d-Date.now()},a.step=function(a){if(!arguments.length)return d;if(g)throw new Error("step cannot be changed mid-flight");return d=+a,k()},a.size=function(a){if(!arguments.length)return e;if(g)throw new Error("size cannot be changed mid-flight");return e=+a,k()},a.shift=function(g){var i=new h;return i.start=function(){return new Date(+b+g)},i.stop=function(){return new Date(+c+g)},i.delay=a.delay,i.step=function(){return d},i.size=function(){return e},i.timeAt=function(a){return new Date(+b+a*d+g)},d3.rebind(i,f,"on")},a.cancel=function(){return g&&(g=clearTimeout(g),f.cancel.call(a)),a},a.timeAt=function(a){return new Date(+b+a*d)},d3.rebind(a,f,"on"),a.step(1e4).size(1440)},e.prototype.add=function(a){return i(this,a instanceof e?a:m(this.size(),a))},e.prototype.subtract=function(a){return j(this,a instanceof e?a:m(this.size(),a))},e.prototype.multiply=function(a){return k(this,a instanceof e?a:m(this.size(),a))},e.prototype.divide=function(a){return l(this,a instanceof e?a:m(this.size(),a))},h.prototype.constant=function(a){return m(this.size(),a)}})(this);