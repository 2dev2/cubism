(function(a){function d(a){return a}function e(a,b){var d={};return d.metric=function(d){function q(a,c){var e=Math.min(l,Math.round((a-j)/k));if(!e)return;m.splice(0,e),e=Math.min(l,e+f),j=a,b(d,new Date(c-e*k),c,k,function(b,d){if(b)return console.warn(b);for(var f=0,g=l-e,h=d.length;f<h;++f)m[f+g]=d[f];n.change.call(i,a,c)})}var i=new h(a,d),j=-Infinity,k=a.step(),l=a.size(),m=[],n=d3.dispatch("change"),o=0,p="beforechange.source-metric-"+ ++c;return i.valueAt=function(a){return m[a]},i.shift=function(c){return e(a,g(b,+c)).metric(d)},i.on=function(b,c){return arguments.length?(c==null&&n.on(b)!=null&&--o,c!=null&&n.on(b)==null&&++o,a.on(p,o>0?q:null),n.on(b,c),i):n.on(b)},i},d}function g(a,b){return function(c,d,e,f,g){a(c,new Date(+d+b),new Date(+e+b),f,g)}}function h(a,b){if(!(a instanceof p))throw new Error("invalid context");b+="",this.context=a,this.toString=function(){return b}}function j(a,b){function c(b,c){if(c instanceof h){if(b.context!==c.context)throw new Error("mismatch context")}else c=new k(b.context,c);h.call(this,b.context,b+" "+a+" "+c),this.left=b,this.right=c}var d=c.prototype=Object.create(h.prototype);return d.valueAt=function(a){return b(this.left.valueAt(a),this.right.valueAt(a))},d.shift=function(a){return new c(this.left.shift(a),this.right.shift(a))},d.on=function(a,b){return arguments.length<2?this.left.on(a):(this.left.on(a,b),this.right.on(a,b),this)},function(a){return new c(this,a)}}function k(a,b){h.call(this,a,b=+b),this.valueOf=function(){return b}}function n(a){return Math.floor(a/1e3)}function o(a){var b=a.indexOf("|"),c=a.substring(0,b),d=c.lastIndexOf(","),e=c.lastIndexOf(",",d-1),f=c.lastIndexOf(",",e-1),g=c.substring(f+1,e)*1e3,h=c.substring(d+1)*1e3;return a.substring(b+1).split(",").slice(1).map(function(a){return+a})}function p(){}var b=a.cubism={version:"0.0.1"},c=0;b.option=function(a,b){var c=location.search.substring(1).split("&"),d=-1,e=c.length,f;while(++d<e)if((f=c[d].split("="))[0]==a)return decodeURIComponent(f[1]);return b};var f=6,i=h.prototype;i.valueAt=function(){return NaN},i.extent=function(){var a=0,b=this.context.size(),c,d=Infinity,e=-Infinity;while(++a<b)c=this.valueAt(a),c<d&&(d=c),c>e&&(e=c);return[d,e]},i.on=function(a,b){return arguments.length<2?null:this},i.add=j("+",function(a,b){return a+b}),i.subtract=j("-",function(a,b){return a-b}),i.multiply=j("*",function(a,b){return a*b}),i.divide=j("/",function(a,b){return a/b}),i.shift=function(){return this},i.on=function(){return arguments.length<2?null:this};var l=k.prototype=Object.create(h.prototype);l.valueAt=function(){return+this},l.extent=function(){return[+this,+this]},p.prototype.cube=function(a){arguments.length||(a="");var b=e(this,function(b,c,d,e,f){d3.json(a+"/1.0/metric"+"?expression="+encodeURIComponent(b)+"&start="+m(c)+"&stop="+m(d)+"&step="+e,function(a){if(!a)return f(new Error("unable to load data"));f(null,a.map(function(a){return a.value}))})});return b.toString=function(){return a},b};var m=d3.time.format.iso;p.prototype.graphite=function(a){arguments.length||(a="");var b=e(this,function(b,c,d,e,f){d3.text(a+"/render?format=raw"+"&target="+encodeURIComponent("alias("+b+",'')")+"&from="+n(c-2*e)+"&until="+n(d-1e3),function(a){if(!a)return f(new Error("unable to load data"));f(null,o(a))})});return b.find=function(b,c){d3.json(a+"/metrics/find?format=completer"+"&query="+encodeURIComponent(b),function(a){if(!a)return c(new Error("unable to find metrics"));c(null,a.metrics.map(function(a){return a.path}))})},b.toString=function(){return a},b},b.context=function(){function l(){var j=Date.now();return e=new Date(Math.floor((j-h-i)/b)*b),d=new Date(e-c*b),g=new Date(Math.floor((j-h)/b)*b),f=new Date(g-c*b),k.domain([d,e]),a}var a=new p,b=1e4,c=1440,d,e,f,g,h=5e3,i=5e3,j=d3.dispatch("beforechange","change","focus"),k=a.scale=d3.time.scale().range([0,c]);return focus,setTimeout(function(){var l=+g+h-Date.now();l<i&&(l+=b),setTimeout(function m(){g=new Date(Math.floor((Date.now()-h)/b)*b),f=new Date(g-c*b),j.beforechange.call(a,f,g),setTimeout(function(){k.domain([d=f,e=g]),j.change.call(a,f,g),j.focus.call(a,focus)},i),setTimeout(m,b)},l)},10),a.step=function(a){return arguments.length?(b=+a,l()):b},a.size=function(a){return arguments.length?(k.range([0,c=+a]),l()):c},a.serverDelay=function(a){return arguments.length?(h=+a,l()):h},a.clientDelay=function(a){return arguments.length?(i=+a,l()):i},a.focus=function(b){return j.focus.call(a,focus=b),a},a.on=function(b,c){return arguments.length<2?j.on(b):(j.on(b,c),c!=null&&(/^beforechange(\.|$)/.test(b)&&c.call(a,f,g),/^change(\.|$)/.test(b)&&c.call(a,d,e),/^focus(\.|$)/.test(b)&&c.call(a,focus)),a)},l()},p.prototype.constant=function(a){return new k(this,+a)},p.prototype.horizon=function(){function m(m){m.on("mousemove.horizon",function(){a.focus(d3.mouse(this)[0])}).on("mouseout.horizon",function(){a.focus(null)}),m.append("canvas").attr("width",e).attr("height",f),m.append("span").attr("class","title").text(j),m.append("span").attr("class","value"),m.each(function(j,m){function w(a,c){p.clearRect(0,0,e,f);var d=r.extent();v=d.every(isFinite),t!=null&&(d=t),g.domain([0,Math.max(d[0],d[1])]);var h;for(var i=0;i<u;++i){p.fillStyle=s[u+i];var j=(i-u+1)*f;g.range([u*f+j,j]),j=g(0);for(var k=0,l=e,m;k<l;++k){m=r.valueAt(k);if(m<=0){h=!0;continue}p.fillRect(k,m=g(m),1,j-m)}}if(h){b==="offset"&&(p.save(),p.translate(0,f),p.scale(1,-1));for(var i=0;i<u;++i){p.fillStyle=s[u-1-i];var j=(i-u+1)*f;g.range([u*f+j,j]),j=g(0);for(var k=0,l=e,m;k<l;++k){m=r.valueAt(k);if(m>=0)continue;p.fillRect(k,g(-m),1,j-g(-m))}}b==="offset"&&p.restore()}}function x(a){a==null&&(a=e-1);var b=r.valueAt(a);q.datum(b).text(isNaN(b)?null:k)}var n=this,o=++c,p=d3.select(n).select("canvas").node().getContext("2d"),q=d3.select(n).select(".value"),r=typeof h=="function"?h.call(n,j,m):h,s=typeof l=="function"?l.call(n,j,m):l,t=typeof i=="function"?i.call(n,j,m):i,u=s.length>>1,v;r.on("change.horizon-"+o,function(a,b){w(a,b),x(),v&&r.on("change.horizon-"+o,d)}),a.on("change.horizon-"+o,w),a.on("focus.horizon-"+o,x)})}var a=this,b="offset",e=a.size(),f=30,g=d3.scale.linear().interpolate(d3.interpolateRound),h=d,i=null,j=d,k=d3.format(".2s"),l=["#08519c","#3182bd","#6baed6","#bdd7e7","#bae4b3","#74c476","#31a354","#006d2c"];return m.mode=function(a){return arguments.length?(b=a+"",m):b},m.height=function(a){return arguments.length?(f=+a,m):f},m.metric=function(a){return arguments.length?(h=a,m):h},m.scale=function(a){return arguments.length?(g=a,m):g},m.extent=function(a){return arguments.length?(i=a,m):i},m.title=function(a){return arguments.length?(j=a,m):j},m.format=function(a){return arguments.length?(k=a,m):k},m.colors=function(a){return arguments.length?(l=a,m):l},m},p.prototype.comparison=function(){function o(o){o.on("mousemove.comparison",function(){a.focus(d3.mouse(this)[0])}).on("mouseout.comparison",function(){a.focus(null)}),o.append("canvas").attr("width",b).attr("height",e),o.append("span").attr("class","title").text(j),o.append("span").attr("class","value primary"),o.append("span").attr("class","value change"),o.each(function(j,o){function z(a,c){s.save(),s.clearRect(0,0,b,e);var d=v.extent(),g=w.extent(),h=x==null?d:x;f.domain([0,h[1]]).range([e,0]),y=d.concat(g).every(isFinite),s.fillStyle=m[2];for(var i=0,j=b;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k<l&&s.fillRect(i&16777214,k,1,l-k)}s.fillStyle=m[0];for(i=0;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k>l&&s.fillRect(i&16777214,l,1,k-l)}s.fillStyle=m[3];for(i=0;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k<=l&&s.fillRect(i&16777214,k,1,n)}s.fillStyle=m[1];for(i=0;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k>l&&s.fillRect(i&16777214,k-n,1,n)}s.restore()}function A(a){a==null&&(a=b-1);var c=v.valueAt(a),d=w.valueAt(a),e=(c-d)/d;t.datum(c).text(isNaN(c)?null:k),u.datum(e).text(isNaN(e)?null:l).attr("class","value change "+(e>0?"positive":e<0?"negative":""))}function B(a,b){z(a,b),A(),y&&(v.on("change.comparison-"+q,d),w.on("change.comparison-"+q,d))}var p=this,q=++c,r=d3.select(p),s=r.select("canvas").node().getContext("2d"),t=r.select(".value.primary"),u=r.select(".value.change"),v=typeof g=="function"?g.call(p,j,o):g,w=typeof h=="function"?h.call(p,j,o):h,x=typeof i=="function"?i.call(p,j,o):i,y;v.on("change.comparison-"+q,B),w.on("change.comparison-"+q,B),a.on("change.comparison-"+q,z),a.on("focus.comparison-"+q,A)})}var a=this,b=a.size(),e=120,f=d3.scale.linear().interpolate(d3.interpolateRound),g=function(a){return a[0]},h=function(a){return a[1]},i=null,j=d,k=q,l=r,m=["#9ecae1","#3182bd","#a1d99b","#31a354"],n=1.5;return o.height=function(a){return arguments.length?(e=+a,o):e},o.primary=function(a){return arguments.length?(g=a,o):g},o.secondary=function(a){return arguments.length?(h=a,o):h},o.scale=function(a){return arguments.length?(f=a,o):f},o.extent=function(a){return arguments.length?(i=a,o):i},o.title=function(a){return arguments.length?(j=a,o):j},o.formatPrimary=function(a){return arguments.length?(k=a,o):k},o.formatChange=function(a){return arguments.length?(l=a,o):l},o.colors=function(a){return arguments.length?(m=a,o):m},o.strokeWidth=function(a){return arguments.length?(n=a,o):n},o};var q=d3.format(".2s"),r=d3.format("+.0%");p.prototype.axis=function(){function d(d){a.on("change.axis-"+ ++c,function(){d.call(b)})}var a=this,b=d3.svg.axis().scale(a.scale);return d3.rebind(d,b,"orient","ticks","tickSubdivide","tickSize","tickPadding","tickFormat")},p.prototype.rule=function(){function b(b){var d=b.append("div").attr("class","line").style("position","fixed").style("top",0).style("right",0).style("bottom",0).style("width","1px").style("pointer-events","none");a.on("focus.rule-"+ ++c,function(a){d.style("display",a==null?"none":null).style("left",function(){return this.parentNode.offsetLeft-window.scrollX+a+"px"})})}var a=this;return b}})(this);