(function(a){function c(a,b){var c={};return c.metric=function(c){function i(){var h=a.step(),i=a.stop(),j=a.size();f||(f=g=a.start()),b(c,f,i,h,function(a,b){if(a)return console.warn(a);b.forEach(function(a){e[Math.round((a[0]-g)/h)%j]=a}),f=new Date(i-d*h)})}var e=[],f,g,h;return setTimeout(i,10),a.on("change",function(){h&&clearTimeout(h),h=setTimeout(i,a.step()/2)}),a.on("cancel",function(){h=clearTimeout(h)}),e.expression=function(){return c},e},c}function e(a){return Math.floor(a/1e3)}function f(a){var b=a.indexOf("|"),c=a.substring(0,b),d=c.lastIndexOf(","),e=c.lastIndexOf(",",d-1),f=c.lastIndexOf(",",e-1),g=c.substring(f+1,e)*1e3,h=c.substring(d+1)*1e3;return a.substring(b+1).split(",").map(function(a,b){return[new Date(g+b*h),+a]}).slice(1)}function g(){}var b=a.cubism={version:"0.0.1"},d=6;g.prototype.cube=function(a){function e(b,c,e,f,g){d3.json(a+"/1.0/metric"+"?expression="+encodeURIComponent(b)+"&start="+d(c)+"&stop="+d(e)+"&step="+f,function(a){if(!a)return g(new Error("unable to load data"));g(null,a.map(function(a){return[d.parse(a.time),a.value]}))})}var b=c(this,e),d=d3.time.format.iso;return arguments.length||(a=""),b.host=function(){return a},b},g.prototype.graphite=function(a){function d(b,c,d,g,h){d3.text(a+"/render?format=raw"+"&target="+encodeURIComponent("alias("+b+",'')")+"&from="+e(c-2*g)+"&until="+e(d-1e3),function(a){if(!a)return h(new Error("unable to load data"));h(null,f(a))})}var b=c(this,d);return arguments.length||(a=""),b.host=function(){return a},b},b.context=function(){function i(){k(),f.change.call(a),j()}function j(){h=setTimeout(i,+c+d-Date.now())}function k(){var f=Date.now();return c=new Date(Math.floor(f/d)*d),b=new Date(c-e*d),a}var a=new g,b=new Date(NaN),c=new Date(NaN),d,e,f=d3.dispatch("change","cancel"),h;return setTimeout(j,10),a.start=function(){return b},a.stop=function(){return c},a.step=function(a){if(!arguments.length)return d;if(h)throw new Error("step cannot be changed mid-flight");return d=+a,k()},a.size=function(a){if(!arguments.length)return e;if(h)throw new Error("size cannot be changed mid-flight");return e=+a,k()},a.cancel=function(){return h&&(h=clearTimeout(h),f.cancel.call(a)),a},d3.rebind(a,f,"on"),a.step(1e4).size(1440)}})(this);