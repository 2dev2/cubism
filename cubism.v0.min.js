(function(a){function d(a){return a}function e(){}function h(a){return Math.floor(a/1e3)}function i(a){var b=a.indexOf("|"),c=a.substring(0,b),d=c.lastIndexOf(","),e=c.lastIndexOf(",",d-1),f=c.lastIndexOf(",",e-1),g=c.substring(f+1,e)*1e3,h=c.substring(d+1)*1e3;return a.substring(b+1).split(",").slice(1).map(function(a){return+a})}function j(a){if(!(a instanceof e))throw new Error("invalid context");this.context=a}function m(a,b){return function(c,d,e,f){a(new Date(+c+b),new Date(+d+b),e,f)}}function n(a,b){j.call(this,a),b=+b;var c=b+"";this.valueOf=function(){return b},this.toString=function(){return c}}function p(a,b){function c(b,c){if(c instanceof j){if(b.context!==c.context)throw new Error("mismatch context")}else c=new n(b.context,c);j.call(this,b.context),this.left=b,this.right=c,this.toString=function(){return b+" "+a+" "+c}}var d=c.prototype=Object.create(j.prototype);return d.valueAt=function(a){return b(this.left.valueAt(a),this.right.valueAt(a))},d.shift=function(a){return new c(this.left.shift(a),this.right.shift(a))},d.on=function(a,b){return arguments.length<2?this.left.on(a):(this.left.on(a,b),this.right.on(a,b),this)},function(a){return new c(this,a)}}var b=a.cubism={version:"0.1.0"},c=0;b.option=function(a,b){var c=location.search.substring(1).split("&"),d=-1,e=c.length,f;while(++d<e)if((f=c[d].split("="))[0]==a)return decodeURIComponent(f[1]);return b},b.context=function(){function o(){var c=Date.now();return g=new Date(Math.floor((c-j-k)/b)*b),f=new Date(g-d*b),i=new Date(Math.floor((c-j)/b)*b),h=new Date(i-d*b),m.domain([f,g]),a}var a=new e,b=1e4,d=1440,f,g,h,i,j=5e3,k=5e3,l=d3.dispatch("prepare","beforechange","change","focus"),m=a.scale=d3.time.scale().range([0,d]),n;return setTimeout(function(){var c=+i+j-Date.now();c<k&&(c+=b),setTimeout(function e(){i=new Date(Math.floor((Date.now()-j)/b)*b),h=new Date(i-d*b),l.prepare.call(a,h,i),setTimeout(function(){m.domain([f=h,g=i]),l.beforechange.call(a,h,i),l.change.call(a,h,i),l.focus.call(a,n)},k),setTimeout(e,b)},c)},10),a.step=function(a){return arguments.length?(b=+a,o()):b},a.size=function(a){return arguments.length?(m.range([0,d=+a]),o()):d},a.serverDelay=function(a){return arguments.length?(j=+a,o()):j},a.clientDelay=function(a){return arguments.length?(k=+a,o()):k},a.focus=function(b){return l.focus.call(a,n=b),a},a.on=function(b,c){return arguments.length<2?l.on(b):(l.on(b,c),c!=null&&(/^prepare(\.|$)/.test(b)&&c.call(a,h,i),/^beforechange(\.|$)/.test(b)&&c.call(a,f,g),/^change(\.|$)/.test(b)&&c.call(a,f,g),/^focus(\.|$)/.test(b)&&c.call(a,n)),a)},d3.select(window).on("keydown.context-"+ ++c,function(){switch(!d3.event.metaKey&&d3.event.keyCode){case 37:n==null&&(n=d-1),n>0&&a.focus(--n);break;case 39:n==null&&(n=d-2),n<d-1&&a.focus(++n);break;default:return}d3.event.preventDefault()}),o()};var f=e.prototype;f.constant=function(a){return new n(this,+a)},f.cube=function(a){arguments.length||(a="");var b={},c=this;return b.metric=function(b){return c.metric(function(c,d,e,f){d3.json(a+"/1.0/metric"+"?expression="+encodeURIComponent(b)+"&start="+g(c)+"&stop="+g(d)+"&step="+e,function(a){if(!a)return f(new Error("unable to load data"));f(null,a.map(function(a){return a.value}))})},b+="")},b.toString=function(){return a},b};var g=d3.time.format.iso;f.graphite=function(a){arguments.length||(a="");var b={},c=this;return b.metric=function(b){return c.metric(function(c,d,e,f){d3.text(a+"/render?format=raw"+"&target="+encodeURIComponent("alias("+b+",'')")+"&from="+h(c-2*e)+"&until="+h(d-1e3),function(a){if(!a)return f(new Error("unable to load data"));f(null,i(a))})},b+="")},b.find=function(b,c){d3.json(a+"/metrics/find?format=completer"+"&query="+encodeURIComponent(b),function(a){if(!a)return c(new Error("unable to find metrics"));c(null,a.metrics.map(function(a){return a.path}))})},b.toString=function(){return a},b};var k=j.prototype;k.valueAt=function(){return NaN},k.extent=function(){var a=0,b=this.context.size(),c,d=Infinity,e=-Infinity;while(++a<b)c=this.valueAt(a),c<d&&(d=c),c>e&&(e=c);return[d,e]},k.on=function(a,b){return arguments.length<2?null:this},k.shift=function(){return this},k.on=function(){return arguments.length<2?null:this},f.metric=function(a,b){function q(b,c){var d=Math.min(i,Math.round((b-g)/h));if(!d||p)return;p=!0,d=Math.min(i,d+l);var f=new Date(c-d*h);a(f,c,h,function(a,b){p=!1;if(a)return console.warn(a);var d=Math.round((f-g)/h);for(var i=0,j=b.length;i<j;++i)k[i+d]=b[i];n.change.call(e,g,c)})}function r(a,b){k.splice(0,Math.max(0,Math.min(i,Math.round((a-g)/h)))),g=a}var d=this,e=new j(d),f=".metric-"+ ++c,g=-Infinity,h=d.step(),i=d.size(),k=[],n=d3.dispatch("change"),o=0,p;return e.valueAt=function(a){return k[a]},e.shift=function(b){return d.metric(m(a,+b))},e.on=function(a,b){return arguments.length?(b==null&&n.on(a)!=null&&--o,b!=null&&n.on(a)==null&&++o,d.on("prepare"+f,o>0?q:null),d.on("beforechange"+f,o>0?r:null),n.on(a,b),e):n.on(a)},arguments.length>1&&(e.toString=function(){return b}),e};var l=6,o=n.prototype=Object.create(j.prototype);o.valueAt=function(){return+this},o.extent=function(){return[+this,+this]},k.add=p("+",function(a,b){return a+b}),k.subtract=p("-",function(a,b){return a-b}),k.multiply=p("*",function(a,b){return a*b}),k.divide=p("/",function(a,b){return a/b}),f.horizon=function(){function o(o){o.on("mousemove.horizon",function(){a.focus(d3.mouse(this)[0])}).on("mouseout.horizon",function(){a.focus(null)}),o.append("canvas").attr("width",f).attr("height",g),o.append("span").attr("class","title").text(k),o.append("span").attr("class","value"),o.each(function(k,o){function B(c,d){r.save();var i=t.extent();A=i.every(isFinite),v!=null&&(i=v);var j=0,k=Math.max(-i[0],i[1]);if(this===a){if(k==y){j=f-l;var m=(c-w)/x;if(m<f){var n=e.getContext("2d");n.clearRect(0,0,f,g),n.drawImage(r.canvas,m,0,f-m,g,0,0,f-m,g),r.clearRect(0,0,f,g),r.drawImage(n.canvas,0,0)}}w=c}h.domain([0,y=k]),r.clearRect(j,0,f-j,g);var o;for(var p=0;p<z;++p){r.fillStyle=u[z+p];var q=(p-z+1)*g;h.range([z*g+q,q]),q=h(0);for(var s=j,B=f,C;s<B;++s){C=t.valueAt(s);if(C<=0){o=!0;continue}r.fillRect(s,C=h(C),1,q-C)}}if(o){b==="offset"&&(r.translate(0,g),r.scale(1,-1));for(var p=0;p<z;++p){r.fillStyle=u[z-1-p];var q=(p-z+1)*g;h.range([z*g+q,q]),q=h(0);for(var s=j,B=f,C;s<B;++s){C=t.valueAt(s);if(C>=0)continue;r.fillRect(s,h(-C),1,q-h(-C))}}}r.restore()}function C(a){a==null&&(a=f-1);var b=t.valueAt(a);s.datum(b).text(isNaN(b)?null:m)}var p=this,q=++c,r=d3.select(p).select("canvas").node().getContext("2d"),s=d3.select(p).select(".value"),t=typeof i=="function"?i.call(p,k,o):i,u=typeof n=="function"?n.call(p,k,o):n,v=typeof j=="function"?j.call(p,k,o):j,w=-Infinity,x=a.step(),y,z=u.length>>1,A;a.on("change.horizon-"+q,B),a.on("focus.horizon-"+q,C),t.on("change.horizon-"+q,function(a,b){B(a,b),C(),A&&t.on("change.horizon-"+q,d)})})}var a=this,b="offset",e=document.createElement("canvas"),f=e.width=a.size(),g=e.height=30,h=d3.scale.linear().interpolate(d3.interpolateRound),i=d,j=null,k=d,m=d3.format(".2s"),n=["#08519c","#3182bd","#6baed6","#bdd7e7","#bae4b3","#74c476","#31a354","#006d2c"];return o.mode=function(a){return arguments.length?(b=a+"",o):b},o.height=function(a){return arguments.length?(e.height=g=+a,o):g},o.metric=function(a){return arguments.length?(i=a,o):i},o.scale=function(a){return arguments.length?(h=a,o):h},o.extent=function(a){return arguments.length?(j=a,o):j},o.title=function(a){return arguments.length?(k=a,o):k},o.format=function(a){return arguments.length?(m=a,o):m},o.colors=function(a){return arguments.length?(n=a,o):n},o},f.comparison=function(){function o(o){o.on("mousemove.comparison",function(){a.focus(d3.mouse(this)[0])}).on("mouseout.comparison",function(){a.focus(null)}),o.append("canvas").attr("width",b).attr("height",e),o.append("span").attr("class","title").text(j),o.append("span").attr("class","value primary"),o.append("span").attr("class","value change"),o.each(function(j,o){function z(a,c){s.save(),s.clearRect(0,0,b,e);var d=v.extent(),g=w.extent(),h=x==null?d:x;f.domain([0,h[1]]).range([e,0]),y=d.concat(g).every(isFinite),s.fillStyle=m[2];for(var i=0,j=b;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k<l&&s.fillRect(i&16777214,k,1,l-k)}s.fillStyle=m[0];for(i=0;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k>l&&s.fillRect(i&16777214,l,1,k-l)}s.fillStyle=m[3];for(i=0;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k<=l&&s.fillRect(i&16777214,k,1,n)}s.fillStyle=m[1];for(i=0;i<j;++i){var k=f(v.valueAt(i)),l=f(w.valueAt(i));k>l&&s.fillRect(i&16777214,k-n,1,n)}s.restore()}function A(a){a==null&&(a=b-1);var c=v.valueAt(a),d=w.valueAt(a),e=(c-d)/d;t.datum(c).text(isNaN(c)?null:k),u.datum(e).text(isNaN(e)?null:l).attr("class","value change "+(e>0?"positive":e<0?"negative":""))}function B(a,b){z(a,b),A(),y&&(v.on("change.comparison-"+q,d),w.on("change.comparison-"+q,d))}var p=this,q=++c,r=d3.select(p),s=r.select("canvas").node().getContext("2d"),t=r.select(".value.primary"),u=r.select(".value.change"),v=typeof g=="function"?g.call(p,j,o):g,w=typeof h=="function"?h.call(p,j,o):h,x=typeof i=="function"?i.call(p,j,o):i,y;v.on("change.comparison-"+q,B),w.on("change.comparison-"+q,B),a.on("change.comparison-"+q,z),a.on("focus.comparison-"+q,A)})}var a=this,b=a.size(),e=120,f=d3.scale.linear().interpolate(d3.interpolateRound),g=function(a){return a[0]},h=function(a){return a[1]},i=null,j=d,k=q,l=r,m=["#9ecae1","#3182bd","#a1d99b","#31a354"],n=1.5;return o.height=function(a){return arguments.length?(e=+a,o):e},o.primary=function(a){return arguments.length?(g=a,o):g},o.secondary=function(a){return arguments.length?(h=a,o):h},o.scale=function(a){return arguments.length?(f=a,o):f},o.extent=function(a){return arguments.length?(i=a,o):i},o.title=function(a){return arguments.length?(j=a,o):j},o.formatPrimary=function(a){return arguments.length?(k=a,o):k},o.formatChange=function(a){return arguments.length?(l=a,o):l},o.colors=function(a){return arguments.length?(m=a,o):m},o.strokeWidth=function(a){return arguments.length?(n=a,o):n},o};var q=d3.format(".2s"),r=d3.format("+.0%");f.axis=function(){function f(g){function k(){return j.select(function(){return this.appendChild(j.select("text").node().cloneNode())}).style("display","none").text(null)}var h=++c,i,j=g.append("svg").attr("width",a.size()).attr("height",Math.max(28,-f.tickSize())).append("g").attr("transform","translate(0,"+(d.orient()==="top"?27:4)+")").call(d);a.on("change.axis-"+h,function(){j.call(d),i||(i=k())}),a.on("focus.axis-"+h,function(a){if(i)if(a==null)i.style("display","none"),j.selectAll("text").style("fill-opacity",null);else{i.style("display",null).attr("x",a).text(e(b.invert(a)));var c=i.node().getComputedTextLength()+6;j.selectAll("text").style("fill-opacity",function(d){return Math.abs(b(d)-a)<c?0:1})}})}var a=this,b=a.scale,d=d3.svg.axis().scale(b),e=a.step()<6e4?s:t;return d3.rebind(f,d,"orient","ticks","tickSubdivide","tickSize","tickPadding","tickFormat")};var s=d3.time.format("%I:%M:%S %p"),t=d3.time.format("%I:%M %p");f.rule=function(){function b(b){var d=b.append("div").attr("class","line").style("position","fixed").style("top",0).style("right",0).style("bottom",0).style("width","1px").style("pointer-events","none");a.on("focus.rule-"+ ++c,function(a){d.style("display",a==null?"none":null).style("left",function(){return this.parentNode.getBoundingClientRect().left+a+"px"})})}var a=this;return b}})(this);